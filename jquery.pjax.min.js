/*
 * 
 * pjax
 * 
 * ---
 * @Copyright(c) 2012, falsandtru
 * @license MIT  http://opensource.org/licenses/mit-license.php  http://sourceforge.jp/projects/opensource/wiki/licenses%2FMIT_license
 * @version 1.16.4
 * @updated 2013/07/14
 * @author falsandtru  http://fat.main.jp/  http://sa-kusaku.sakura.ne.jp/
 * @Compressor Closure Compiler
 */
(function(){function C(u){function C(a,b){b.id=1;p[b.id]=b;b.link&&jQuery(a).undelegate(b.link,b.nss.click).delegate(b.link,b.nss.click,b.id,function(a){a.timeStamp=(new Date).getTime();if(1<a.which||(a.metaKey||a.ctrlKey||a.shiftKey||a.altKey)||(e.location.protocol!==this.protocol||e.location.host!==this.host)||e.location.pathname===this.pathname&&e.location.search===this.search&&e.location.hash!==this.hash)return this;var b,f,q;b=p[a.data];f=this.href;b.area=h(b.options.area,null,[a])||b.options.area;
b.landing&&(b.landing=!1);if(!b.disable&&jQuery(b.area).length)return b.off(),b.cache[a.type.toLowerCase()]&&(q=w(b.history,f)),E(this,a,f,f!==e.location.href,q),a.preventDefault(),!1});b.form&&jQuery(a).undelegate(b.form,b.nss.submit).delegate(b.form,b.nss.submit,b.id,function(a){a.timeStamp=(new Date).getTime();var b,f,q;b=p[a.data];f=this.action;b.area=h(b.options.area,null,[a])||b.options.area;b.landing&&(b.landing=!1);if(!b.disable&&jQuery(b.area).length)return b.off(),b.cache[a.type.toLowerCase()]&&
(q=w(b.history,f)),E(this,a,f,!0,q),a.preventDefault(),!1});jQuery(e).unbind(b.nss.popstate).bind(b.nss.popstate,b.id,function(a){a.timeStamp=(new Date).getTime();var b,f,q;b=p[a.data];f=e.location.href;b.area=h(b.options.area,null,[a])||b.options.area;if(b.landing){if(b.landing===e.location.href){b.landing=!1;return}b.landing=!1}if(!b.disable&&jQuery(b.area).length)return b.off(),b.cache[a.type.toLowerCase()]&&(q=w(b.history,f)),E(this,a,f,!1,q),a.preventDefault(),!1});jQuery("script[src]").each(function(){this.src in
b.log.script||(b.log.script[this.src]=!0)})}function E(f,b,m,I,s){function t(){jQuery.when(H(a.wait),jQuery.ajax(jQuery.extend(!0,{},a.ajax,D,{url:m,beforeSend:function(c){g=c;g.setRequestHeader(a.nss.requestHeader,"true");g.setRequestHeader(a.nss.requestHeader+"-Area",a.area);g.setRequestHeader(a.nss.requestHeader+"-CSS",a.load.css);g.setRequestHeader(a.nss.requestHeader+"-Script",a.load.script);h(a.callbacks.ajax.beforeSend,f,[b,a.parameter,g],a.callbacks.async)},success:function(c,d,m){l=c;r=d;
g=m;h(a.callbacks.ajax.success,f,[b,a.parameter,l,r,g],a.callbacks.async)},error:function(c,d,l){g=c;v=d;A=l;var k=p[a.id]&&p[a.id].validate?p[a.id].validate.clone({name:"jquery.pjax.js - drive()"}):k;k&&k.start();k&&k.test("++",1,[m,e.location.href],"ajax_regular()");k&&k.test("++",1,[g,v,A],"ajax error");h(a.callbacks.ajax.error,f,[b,a.parameter,g,v,A],a.callbacks.async);if(a.fallback)return"function"===typeof a.fallback?a.fallback(b):F(b,k);k&&k.end()}}))).done(function(){y()}).fail().always()}
function u(){jQuery.ajax(jQuery.extend(!0,{},a.ajax,D,{url:m,beforeSend:function(c){g=c;g.setRequestHeader(a.nss.requestHeader,"true");g.setRequestHeader(a.nss.requestHeader+"-Area",a.area);g.setRequestHeader(a.nss.requestHeader+"-CSS",a.load.css);g.setRequestHeader(a.nss.requestHeader+"-Script",a.load.script);h(a.callbacks.ajax.beforeSend,f,[b,a.parameter,g],a.callbacks.async)},success:function(c,d,m){l=c;r=d;g=m;h(a.callbacks.ajax.success,f,[b,a.parameter,l,r,g],a.callbacks.async);y()},error:function(c,
d,l){g=c;v=d;A=l;var k=p[a.id]&&p[a.id].validate?p[a.id].validate.clone({name:"jquery.pjax.js - drive()"}):k;k&&k.start();k&&k.test("++",1,[m,e.location.href],"ajax_legacy()");k&&k.test("++",1,[g,v,A],"ajax error");h(a.callbacks.ajax.error,f,[b,a.parameter,g,v,A],a.callbacks.async);if(a.fallback)return"function"===typeof a.fallback?a.fallback(b):F(b,k);k&&k.end()}}))}function y(c){var d=p[a.id]&&p[a.id].validate?p[a.id].validate.clone({name:"jquery.pjax.js - update()"}):d;d&&d.start();d&&(d.scope=
function(a){return eval(a)});d&&d.test("1",1,0,"update()");d&&d.test("++",1,0,"update:start");a:if(a.speedcheck&&a.log.speed.name.push("update_start"),a.speedcheck&&a.log.speed.time.push(a.speed.now()-a.log.speed.fire),!1!==h(a.callbacks.update.before,f,[b,a.parameter,l,r,g],a.callbacks.async)){var n=window,k=document,e,s,t;try{d&&d.test("++",1,0,"update:try");d&&d.test("++",1,c?0:[a.contentType,g.getResponseHeader("Content-Type")],"update:content-type");if(!c&&!RegExp(a.contentType.replace(/\s*[,;]\s*(.|$)/g,
function(a,b){return b?"|"+b:""}),"i").test(g.getResponseHeader("Content-Type")))throw Error("throw: content-type mismatch");d&&d.test("++",c?"'usable'":"'unusable'",0,"update:cache");c&&!1!==h(a.callbacks.update.cache.load.before,f,[b,a.parameter,c],a.callbacks.async)&&(g=c.XMLHttpRequest,l=g.responseText,r=c.dataType,e=c.title,s=c.css,t=c.script,h(a.callbacks.update.cache.load.after,f,[b,a.parameter,c],a.callbacks.async));d&&d.test("++",1,0,"update:initialize");var x=jQuery(l),u=0<x.filter("title").length,
v=a.area.replace(/(\((.*?(\(.*?\).*?)?)*?\)|\S)(,|$)/g,function(a,b,f,c,d){return b+(d?"|":"")}).split(/\s*\|(?!=)\s*/);e=e?e:u?x.filter("title").text():jQuery("<span/>").html(G(l,"<title>([^<]*)</title>").join()).text();if(!jQuery(a.area).length||!x.find(a.area).add(x.filter(a.area)).length)throw Error("throw: area length mismatch");d&&d.test("++",1,m,"update:url");if(!1!==h(a.callbacks.update.url.before,f,[b,a.parameter,l,r,g],a.callbacks.async)){m=m.replace(RegExp("[?&]"+a.server.query+"=[^&#]*"),
"");I&&n.history.pushState(a.gns,n.opera||-1!==n.navigator.userAgent.toLowerCase().indexOf("opera")?e:k.title,m);switch(!0){case /Mobile(\/\w+)? Safari/i.test(n.navigator.userAgent):n.history.back(),n.history.forward()}h(a.callbacks.update.url.after,f,[b,a.parameter,l,r,g],a.callbacks.async)}d&&d.test("++",1,e,"update:title");!1!==h(a.callbacks.update.title.before,f,[b,a.parameter,l,r,g],a.callbacks.async)&&(k.title=e,h(a.callbacks.update.title.after,f,[b,a.parameter,l,r,g],a.callbacks.async));d&&
d.test("++",1,v,"update:content");if(!1!==h(a.callbacks.update.content.before,f,[b,a.parameter,l,r,g],a.callbacks.async)){jQuery(a.area).children("."+a.nss.class4html+"-check").remove();for(var k=0,y;y=v[k];k++)jQuery(y).html(x.find(y).add(x.filter(y)).children()).append(jQuery("<div/>",{"class":a.nss.class4html+"-check",style:"display: block !important; visibility: hidden !important; width: auto !important; height: 0 !important; margin: 0 !important; padding: 0 !important; border: none !important; position: absolute !important; top: -9999px !important; left: -9999px !important; font-size: 12px !important; text-indent: 0 !important;"}).text("pjax"));
jQuery(document).trigger(a.gns+".DOMContentLoaded");h(a.callbacks.update.content.after,f,[b,a.parameter,l,r,g],a.callbacks.async)}d&&d.test("++",1,0,"update:css");var A=function(){var c=p[a.id]&&p[a.id].validate?p[a.id].validate.clone({name:"jquery.pjax.js - load_css()"}):c;c&&c.start();c&&(c.scope=function(a){return eval(a)});if(!1!==h(a.callbacks.update.css.before,f,[b,a.parameter,l,r,g],a.callbacks.async)){s=s?s:u?x.find('link[rel~="stylesheet"], style').add(x.filter('link[rel~="stylesheet"], style')):
G(l,"(<link[^>]*?rel=.[^\"']*stylesheet[^>]*>|<style[^>]*>(.|[\n\r])*?</style>)");w(a.history,m)&&(w(a.history,m).css=s);jQuery('link[rel~="stylesheet"], style').filter(function(){return jQuery.data(this,a.nss.data,!0)});for(var d=0,e,k=jQuery('link[rel~="stylesheet"]'),q=jQuery("style"),n;e=s[d];d++){n=!1;e=u?e:jQuery(e)[0];switch(e.tagName.toLowerCase()){case "link":if(k.filter(function(){if(n||this.href!==e.href)return!1;n=!0;jQuery.removeData(this,a.nss.data);return!0}).length)continue;break;
case "style":if(q.filter(function(){if(n||!jQuery.data(this,a.nss.data)||this.innerHTML!==e.innerHTML)return!1;n=!0;jQuery.removeData(this,a.nss.data);return!0}).length)continue}jQuery("head").append(e);e=null}jQuery('link[rel~="stylesheet"], style').filter(function(){return jQuery.data(this,a.nss.data)}).remove();jQuery(document).trigger(a.gns+".ready");!1!==h(a.callbacks.update.css.after,f,[b,a.parameter,l,r,g],a.callbacks.async)&&(a.speedcheck&&a.log.speed.name.push("css"),a.speedcheck&&a.log.speed.time.push(a.speed.now()-
a.log.speed.fire))}c&&c.end()};a.load.css&&setTimeout(function(){A()},a.load.async||0);!a.load.css&&jQuery(document).trigger(a.gns+".ready");d&&d.test("++",1,0,"update:script");var z=function(c){var d=p[a.id]&&p[a.id].validate?p[a.id].validate.clone({name:"jquery.pjax.js - load_script()"}):d;d&&d.start();d&&(d.scope=function(a){return eval(a)});if(!1!==h(a.callbacks.update.script.before,f,[b,a.parameter,l,r,g],a.callbacks.async)){var e=[];t=t?t:u?x.find("script").add(x.filter("script")):G(l,"(?:[^'\"]|^s*)(<script[^>]*>(.|[\n\r])*?\x3c/script>)(?:[^'\"]|s*$)");
w(a.history,m)&&(w(a.history,m).script=t);for(var n=0,k;k=t[n];n++)if(k=u?k:jQuery(k)[0],"sync"!==c||k.defer)"async"===c&&k.defer||!k.childNodes.length&&k.src in a.log.script||(k.src&&(a.log.script[k.src]=!0),jQuery.when?(k=k.src?jQuery.ajax(jQuery.extend(!0,{},a.ajax,{url:k.src,dataType:"script",async:!1,global:!1})):jQuery.Deferred().resolve(a.load.execute?k:q),e.push(k)):jQuery("head").append(k),k=null);jQuery.when&&e.length&&jQuery.when.apply(null,e).done(function(){for(var a=0,b;b=arguments[a];a++)0<
Number(b.nodeType)&&(!b.type||-1<b.type.toLowerCase().indexOf("text/javascript"))&&eval((b.text||b.textContent||b.innerHTML||"").replace(/^\s*<!(?:\[CDATA\[|\-\-)/,"/*$0*/"))});!1!==h(a.callbacks.update.script.after,f,[b,a.parameter,l,r,g],a.callbacks.async)&&(a.speedcheck&&"async"===c&&a.log.speed.name.push("script"),a.speedcheck&&"async"===c&&a.log.speed.time.push(a.speed.now()-a.log.speed.fire))}d&&d.end()};a.load.script&&setTimeout(function(){z("async")},a.load.async||0);a.load.script&&!a.load.sync&&
setTimeout(function(){z("sync")},a.load.async||0);d&&d.test("++",1,0,"update:scroll");var D=function(f){var c,d;switch(b.type.toLowerCase()){case "click":case "submit":c=f?h(a.scrollLeft,null,[b]):c;c=0<=c?c:a.scrollLeft;c=null===c?jQuery(n).scrollLeft():parseInt(Number(c));d=f?h(a.scrollTop,null,[b]):d;d=0<=d?d:a.scrollTop;d=null===d?jQuery(n).scrollTop():parseInt(Number(d));n.scrollTo(c,d);break;case "popstate":n.history.state instanceof Object&&isFinite(n.history.state.scrollY)&&(n.scrollTo(jQuery(n).scrollLeft(),
n.history.state.scrollY),n.history.state.scrollY=q,n.history.replaceState(n.history.state,e,m))}};D(!1);d&&d.test("++",1,0,"update:rendering");setTimeout(function(){var c=jQuery(a.area).children("."+a.nss.class4html+"-check");c.filter(function(){return this.clientWidth||jQuery(this).is(":hidden")}).length===c.length?!1!==h(a.callbacks.update.rendering.before,f,[b,a.parameter],a.callbacks.async)&&(c.remove(),a.load.script&&a.load.sync&&setTimeout(function(){z("sync")},a.load.async||0),D(!0),jQuery(window).trigger(a.gns+
".load"),!1!==h(a.callbacks.update.rendering.after,f,[b,a.parameter],a.callbacks.async)&&(a.speedcheck&&a.log.speed.name.push("ready"),a.speedcheck&&a.log.speed.time.push(a.speed.now()-a.log.speed.fire),a.speedcheck&&console.log(a.log.speed.time),a.speedcheck&&console.log(a.log.speed.name))):c.length&&setTimeout(function(){arguments.callee()},a.interval)},0);d&&d.test("++",1,0,"update:cache");(a.cache.click||a.cache.submit||a.cache.popstate)&&("POST"!==a.ajax.type&&!1!==h(a.callbacks.update.cache.save.before,
f,[b,a.parameter,c],a.callbacks.async))&&(w(a.history,m,e,C,l,r,g),h(a.callbacks.update.cache.save.after,f,[b,a.parameter,c],a.callbacks.async));d&&d.test("++",1,0,"update:verify");if(!1!==h(a.callbacks.update.verify.before,f,[b,a.parameter],a.callbacks.async)){if(m===n.location.href)a.retry=!0;else if(a.retry)a.retry=!1,E(f,b,n.location.href,!1,a.cache[b.type.toLowerCase()]?w(a.history,n.location.href):q);else throw Error("throw: location mismatch");h(a.callbacks.update.verify.after,f,[b,a.parameter],
a.callbacks.async)}if(!1===h(a.callbacks.update.success,f,[b,a.parameter,l,r,g],a.callbacks.async))break a;if(!1===h(a.callbacks.update.complete,f,[b,a.parameter,l,r,g],a.callbacks.async))break a;if(!1===h(a.callback,f,[b,a.parameter,l,r,g],a.callbacks.async))break a;d&&d.test("++",1,0,"update: success")}catch(B){d&&d.test("++",!String(B.message).indexOf("throw:"),B,"update:catch");d&&d.test("++",!("throw: location mismatch"===B.message&&m!==n.location.href),[m,n.location.href],"!( err.message === 'throw: location mismatch' && url !== win.location.href )");
c&&w(a.history,m,e,null);if(!1===h(a.callbacks.update.error,f,[b,a.parameter,l,r,g],a.callbacks.async))break a;if(!1===h(a.callbacks.update.complete,f,[b,a.parameter,l,r,g],a.callbacks.async))break a;d&&d.test("++",1,[m,n.location.href],"update: error");if(a.fallback)return"function"===typeof a.fallback?a.fallback(b):F(b,d)}!1!==h(a.callbacks.update.after,f,[b,a.parameter,l,r,g],a.callbacks.async)&&(a.on(),a.speedcheck&&a.log.speed.name.push("end"),a.speedcheck&&a.log.speed.time.push(a.speed.now()-
a.log.speed.fire),d&&d.test("++",1,0,"update:end"),d&&d.end())}}var c=p[a.id]&&p[a.id].validate?p[a.id].validate.clone({name:"jquery.pjax.js - drive()"}):c;c&&c.start();c&&(c.scope=function(a){return eval(a)});c&&c.test("++",1,[m,b.type],"drive()");c&&c.test("++",1,0,"drive:start");a.speedcheck&&(a.log.speed.fire=b.timeStamp);a.speedcheck&&(a.log.speed.time=[]);a.speedcheck&&(a.log.speed.name=[]);a.speedcheck&&a.log.speed.name.push("fire");a.speedcheck&&a.log.speed.time.push(a.speed.now()-a.log.speed.fire);
if(!1!==h(a.callbacks.before,f,[b,a.parameter],a.callbacks.async))if(s)c&&c.test("++",1,0,"drive:update"),jQuery.when?jQuery.when(H(a.wait)).done(function(){y(s)}):y(s),c&&c.test("++",1,0,"drive:end"),c&&c.end();else{c&&c.test("++",1,0,"drive:initialize");var l,r,g,v,A,C,z=[],D={xhr:function(){g=h(a.callbacks.ajax.xhr,f,[b,a.parameter],a.callbacks.async);return g=g instanceof Object&&g instanceof e.XMLHttpRequest?g:g||jQuery.ajaxSettings.xhr()},dataFilter:function(c,d){l=c;r=d;return h(a.callbacks.ajax.dataFilter,
f,[b,a.parameter,l,r],a.callbacks.async)||l},complete:function(c,d){g=c;v=d;h(a.callbacks.ajax.complete,f,[b,a.parameter,g,v],a.callbacks.async)}},B;for(B in D)B in a.callbacks.ajax||"xhr"===B||(D[B]=q);c&&c.test("++",1,0,"drive:popstate");"popstate"===b.type.toLowerCase()&&((z=m.match(/\?[^\s]*/))&&"?"!==z[0]&&(a.ajax.type="GET"),a.ajax.data=null);c&&c.test("++",1,0,"drive:submit");c&&c.test("*",1,jQuery(b.target).serialize(),"drive:submit");"submit"===b.type.toLowerCase()&&(m=m.replace(/\?[^\s]*/,
""),a.ajax.type=jQuery(b.target).attr("method").toUpperCase(),"GET"===a.ajax.type&&(c&&c.test("++",1,jQuery(b.target).serialize(),"drive:serialize"),m+="?"+jQuery(b.target).serialize(),a.ajax.data=null),"POST"===a.ajax.type&&(c&&c.test("++",1,jQuery(b.target).serializeArray(),"drive:serializeArray"),a.ajax.data=jQuery(b.target).serializeArray()));c&&c.test("/",1,0,"drive:url");a.server.query&&(m=m.replace(/(#[^\s]*|)$/,(m.match(/\?/)?"&":"?")+encodeURIComponent(a.server.query)+"=1$1"));c&&c.test("++",
1,0,"drive:ajax");a.speedcheck&&a.log.speed.name.push("ajax_start");a.speedcheck&&a.log.speed.time.push(a.speed.now()-a.log.speed.fire);jQuery.when?t():u();!1!==h(a.callbacks.after,f,[b,a.parameter],a.callbacks.async)&&(c&&c.test("++",1,0,"drive:end"),c&&c.end())}}function h(a,b,m,e){if("function"===typeof a)return e?setTimeout(function(){a.apply(b,m)},0):a.apply(b,m)}function H(a){var b=jQuery.Deferred();if(!a)return b.resolve();setTimeout(function(){b.resolve()},a);return b.promise()}function F(a,
b){b&&b.test("++",1,0,"fallback()");b&&b.end();"click"===a.type.toLowerCase()?e.location.href=a.currentTarget.href:"submit"===a.type.toLowerCase()?context.submit():"popstate"===a.type.toLowerCase()&&e.location.reload()}function G(a,b){var m=[];a.replace(RegExp(b,"gim"),function(a,b){m.push(b)});return m}function w(a,b,m,e,h,p,s){var t;switch(!0){case a===q||b===q:break;case m===q:a.data[b]&&(new Date).getTime()>a.data[b].timestamp+a.config.expire&&arguments.callee(a,b,null,null);t=a.data[b];break;
case null===e:for(var c=0,l;l=a.order[c];c++)b===l&&(a.order.splice(c,1),a.size-=a.data[l].size,a.data[l]=null,delete a.data[l]);break;default:a.order.unshift(b);for(c=1;l=a.order[c];c++)b===l&&a.order.splice(c,1);if(a.data[b])break;e=e||1.8*h.length;a.size=a.size||0;a.size+=e;a.data[b]={data:null,dataType:p,XMLHttpRequest:s,title:m,size:e,timestamp:(new Date).getTime()};for(c=a.order.length-1;b=a.order[c];c--)if(c>=a.config.length||a.size>a.config.size||(new Date).getTime()>a.data[b].timestamp+a.config.expire)a.order.splice(c,
1),a.size=a.size||0,a.size-=a.data[b].size,a.data[b]=null,delete a.data[b]}return t}function z(a,b,e){var h;switch(!0){case b===q:h=jQuery.falsandtru[a];break;case e===q:h=a in jQuery.falsandtru?jQuery.falsandtru[a][b]:q;break;case e!==q:jQuery.falsandtru[a]instanceof Object||(jQuery.falsandtru[a]={}),jQuery.falsandtru[a][b]instanceof Object&&e instanceof Object?jQuery.extend(!0,jQuery.falsandtru[a][b],e):jQuery.falsandtru[a][b]=e,h=jQuery.falsandtru[a][b]}return h}if("function"===typeof this)return arguments.callee.apply(jQuery(J),
arguments);var s=window.validator instanceof Object?window.validator:!1;(s=s?s.clone({name:"jquery.pjax.js",base:!0,timeout:{limit:u&&u.ajax&&u.ajax.timeout?u.ajax.timeout+s.timeout.limit:s.timeout.limit}}):s)&&s.start();s&&s.test("++",1,0,"pjax()");var a=jQuery.extend(!0,{},{id:0,gns:"pjax",ns:q,area:q,link:'a:not([target])[href^="/"]',form:q,scrollTop:0,scrollLeft:0,ajax:{},contentType:"text/html",cache:{click:!1,submit:!1,popstate:!1,length:9,size:1048576,expire:18E5},callback:function(){},callbacks:{ajax:{},
update:{url:{},title:{},content:{},css:{},script:{},cache:{load:{},save:{}},rendering:{},verify:{}},async:!1},parameter:q,load:{css:!1,script:!1,execute:!0,sync:!0,async:0},interval:300,wait:0,fallback:!0,server:{query:""},speedcheck:!1},u),t=[a.gns];jQuery.extend(!0,a,{nss:{pjax:t.join("."),click:["click"].concat(t.join(":")).join("."),submit:["submit"].concat(t.join(":")).join("."),popstate:["popstate"].concat(t.join(":")).join("."),data:t.join(":"),class4html:t.join("-"),requestHeader:["X",t[0].replace(/^\w/,
function(a){return a.toUpperCase()})].join("-"),array:t},server:{query:a.server.query.length?a.server.query:a.gns},log:{script:{},speed:{}},history:{config:a.cache,order:[],data:{}},timestamp:(new Date).getTime(),disable:!1,on:function(){for(var a=1,b=p.length;a<b;a++)p[a].disable=!1},off:function(){for(var a=1,b=p.length;a<b;a++)p[a].disable=!0},landing:e.location.href,validate:s,retry:!0,speed:{now:function(){return(new Date).getTime()}},options:u});jQuery.falsandtru||(jQuery.fn.falsandtru=z,jQuery.falsandtru=
z);jQuery.falsandtru("share","history",a.history);a.history=jQuery.falsandtru("share","history");"pushState"in e.history&&null!==e.history.pushState&&C(this,a);s&&s.end();return{on:a.on,off:a.off}}if("undefined"!==typeof window.jQuery){jQuery=window.jQuery;var q=void 0,e=window,J=document,p=["settings"];jQuery.fn.pjax=C;jQuery.pjax=C;C=null}})();
