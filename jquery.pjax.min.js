/*
 * 
 * pjax
 * 
 * ---
 * @Copyright(c) 2012, falsandtru
 * @license MIT  http://opensource.org/licenses/mit-license.php  http://sourceforge.jp/projects/opensource/wiki/licenses%2FMIT_license
 * @version 1.17.4
 * @updated 2013/08/06
 * @author falsandtru https://github.com/falsandtru/
 * @Compressor Closure Compiler
 */
(function(){function t(s){function t(a,b){b.id=1;p[b.id]=b;b.link&&jQuery(a).undelegate(b.link,b.nss.click).delegate(b.link,b.nss.click,b.id,function(a){a.timeStamp=(new Date).getTime();if(1<a.which||(a.metaKey||a.ctrlKey||a.shiftKey||a.altKey)||(f.location.protocol!==this.protocol||f.location.host!==this.host)||f.location.pathname===this.pathname&&f.location.search===this.search&&f.location.hash!==this.hash)return this;var b,e,g;b=p[a.data];e=this.href;b.area=h(b.options.area,null,[a])||b.options.area;
b.landing&&(b.landing=!1);if(!b.disable&&jQuery(b.area).length)return b.off(),b.cache[a.type.toLowerCase()]&&(g=v(b.history,e)),A(this,a,e,e!==f.location.href,g),a.preventDefault(),!1});b.form&&jQuery(a).undelegate(b.form,b.nss.submit).delegate(b.form,b.nss.submit,b.id,function(a){a.timeStamp=(new Date).getTime();var b,e,g;b=p[a.data];e=this.action;b.area=h(b.options.area,null,[a])||b.options.area;b.landing&&(b.landing=!1);if(!b.disable&&jQuery(b.area).length)return b.off(),b.cache[a.type.toLowerCase()]&&
(g=v(b.history,e)),A(this,a,e,!0,g),a.preventDefault(),!1});jQuery(f).unbind(b.nss.popstate).bind(b.nss.popstate,b.id,function(a){a.timeStamp=(new Date).getTime();var b,e,g;b=p[a.data];e=f.location.href;b.area=h(b.options.area,null,[a])||b.options.area;if(b.landing){if(b.landing===f.location.href){b.landing=!1;return}b.landing=!1}if(!b.disable&&jQuery(b.area).length)return b.off(),b.cache[a.type.toLowerCase()]&&(g=v(b.history,e)),A(this,a,e,!1,g),a.preventDefault(),!1});jQuery("script[src]").each(function(){this.src in
b.log.script||(b.log.script[this.src]=!0)})}function A(e,b,r,I,m){function u(d){var c=p[a.id]&&p[a.id].validate?p[a.id].validate.clone({name:"jquery.pjax.js - update()"}):c;c&&c.start();c&&(c.scope=function(a){return eval(a)});c&&c.test("1",1,0,"update()");c&&c.test("++",1,0,"update:start");a:if(a.speedcheck&&a.log.speed.name.push("update"),a.speedcheck&&a.log.speed.time.push(a.speed.now()-a.log.speed.fire),!1!==h(a.callbacks.update.before,e,[b,a.parameter,n,l,k],a.callbacks.async)){var q=window,
f=document,m,s,t;try{c&&c.test("++",1,0,"update:try");c&&c.test("++",1,d?0:[a.contentType,k.getResponseHeader("Content-Type")],"update:content-type");if(!d&&!RegExp(a.contentType.replace(/\s*[,;]\s*(.|$)/g,function(a,b){return b?"|"+b:""}),"i").test(k.getResponseHeader("Content-Type")))throw Error("throw: content-type mismatch");c&&c.test("++",d?"'usable'":"'unusable'",0,"update:cache");d&&!1!==h(a.callbacks.update.cache.load.before,e,[b,a.parameter,d],a.callbacks.async)&&(k=d.XMLHttpRequest,n=k.responseText,
l=d.dataType,m=d.title,s=d.css,t=d.script,h(a.callbacks.update.cache.load.after,e,[b,a.parameter,d],a.callbacks.async));c&&c.test("++",1,0,"update:initialize");var w=jQuery(n),y=0<w.filter("title").length,x=a.area.replace(/(\((.*?(\(.*?\).*?)?)*?\)|\S)(,|$)/g,function(a,b,e,c,d){return b+(d?"|":"")}).split(/\s*\|(?!=)\s*/);m=m?m:y?w.filter("title").text():jQuery("<span/>").html(D(n,"<title>([^<]*)</title>").join()).text();if(!jQuery(a.area).length||!w.find(a.area).add(w.filter(a.area)).length)throw Error("throw: area length mismatch");
c&&c.test("++",1,r,"update:url");if(!1!==h(a.callbacks.update.url.before,e,[b,a.parameter,n,l,k],a.callbacks.async)){I&&q.history.pushState(q.history.state,q.opera||-1!==q.navigator.userAgent.toLowerCase().indexOf("opera")?m:f.title,r);switch(!0){case /Mobile(\/\w+)? Safari/i.test(q.navigator.userAgent):q.history.back(),q.history.forward()}h(a.callbacks.update.url.after,e,[b,a.parameter,n,l,k],a.callbacks.async)}c&&c.test("++",1,m,"update:title");!1!==h(a.callbacks.update.title.before,e,[b,a.parameter,
n,l,k],a.callbacks.async)&&(f.title=m,h(a.callbacks.update.title.after,e,[b,a.parameter,n,l,k],a.callbacks.async));c&&c.test("++",1,x,"update:content");if(!1!==h(a.callbacks.update.content.before,e,[b,a.parameter,n,l,k],a.callbacks.async)){jQuery(a.area).children("."+a.nss.class4html+"-check").remove();for(var f=0,B;B=x[f];f++)jQuery(B).html(w.find(B).add(w.filter(B)).contents()).append(jQuery("<div/>",{"class":a.nss.class4html+"-check",style:"display: block !important; visibility: hidden !important; width: auto !important; height: 0 !important; margin: 0 !important; padding: 0 !important; border: none !important; position: absolute !important; top: -9999px !important; left: -9999px !important; font-size: 12px !important; text-indent: 0 !important;"}).text("pjax"));
jQuery(document).trigger(a.gns+".DOMContentLoaded");h(a.callbacks.update.content.after,e,[b,a.parameter,n,l,k],a.callbacks.async)}c&&c.test("++",1,0,"update:css");var J=function(){var c=p[a.id]&&p[a.id].validate?p[a.id].validate.clone({name:"jquery.pjax.js - load_css()"}):c;c&&c.start();c&&(c.scope=function(a){return eval(a)});if(!1!==h(a.callbacks.update.css.before,e,[b,a.parameter,n,l,k],a.callbacks.async)){s=s?s:y?w.find('link[rel~="stylesheet"], style').add(w.filter('link[rel~="stylesheet"], style')):
D(n,"(<link[^>]*?rel=.[^\"']*stylesheet[^>]*>|<style[^>]*>(.|[\n\r])*?</style>)");v(a.history,r)&&(v(a.history,r).css=s);jQuery('link[rel~="stylesheet"], style').filter(function(){return jQuery.data(this,a.nss.data,!0)});for(var d=0,g,m=jQuery('link[rel~="stylesheet"]'),f=jQuery("style"),q;g=s[d];d++){q=!1;g=y?g:jQuery(g)[0];switch(g.tagName.toLowerCase()){case "link":if(m.filter(function(){if(q||this.href!==g.href)return!1;q=!0;jQuery.removeData(this,a.nss.data);return!0}).length)continue;break;
case "style":if(f.filter(function(){if(q||!jQuery.data(this,a.nss.data)||this.innerHTML!==g.innerHTML)return!1;q=!0;jQuery.removeData(this,a.nss.data);return!0}).length)continue}jQuery("head").append(g);g=null}jQuery('link[rel~="stylesheet"], style').filter(function(){return jQuery.data(this,a.nss.data)}).remove();jQuery(document).trigger(a.gns+".ready");!1!==h(a.callbacks.update.css.after,e,[b,a.parameter,n,l,k],a.callbacks.async)&&(a.speedcheck&&a.log.speed.name.push("css"),a.speedcheck&&a.log.speed.time.push(a.speed.now()-
a.log.speed.fire))}c&&c.end()};a.load.css&&setTimeout(function(){J()},a.load.async||0);!a.load.css&&jQuery(document).trigger(a.gns+".ready");c&&c.test("++",1,0,"update:script");var E=function(c){var d=p[a.id]&&p[a.id].validate?p[a.id].validate.clone({name:"jquery.pjax.js - load_script()"}):d;d&&d.start();d&&(d.scope=function(a){return eval(a)});if(!1!==h(a.callbacks.update.script.before,e,[b,a.parameter,n,l,k],a.callbacks.async)){var m=[];t=t?t:y?w.find("script").add(w.filter("script")):D(n,"(?:[^'\"]|^s*)(<script[^>]*>(.|[\n\r])*?\x3c/script>)(?:[^'\"]|s*$)");
v(a.history,r)&&(v(a.history,r).script=t);for(var q=0,f;f=t[q];q++)if(f=y?f:jQuery(f)[0],"sync"!==c||f.defer)"async"===c&&f.defer||!f.childNodes.length&&f.src in a.log.script||(f.src&&(a.log.script[f.src]=!0),jQuery.when?(f=f.src?jQuery.ajax(jQuery.extend(!0,{},a.ajax,{url:f.src,dataType:"script",async:!1,global:!1})):jQuery.Deferred().resolve(a.load.execute?f:g),m.push(f)):jQuery("head").append(f),f=null);jQuery.when&&m.length&&jQuery.when.apply(null,m).done(function(){for(var a=0,b;b=arguments[a];a++)0<
Number(b.nodeType)&&(!b.type||-1<b.type.toLowerCase().indexOf("text/javascript"))&&eval((b.text||b.textContent||b.innerHTML||"").replace(/^\s*<!(?:\[CDATA\[|\-\-)/,"/*$0*/"))});!1!==h(a.callbacks.update.script.after,e,[b,a.parameter,n,l,k],a.callbacks.async)&&(a.speedcheck&&"async"===c&&a.log.speed.name.push("script"),a.speedcheck&&"async"===c&&a.log.speed.time.push(a.speed.now()-a.log.speed.fire))}d&&d.end()};a.load.script&&setTimeout(function(){E("async")},a.load.async||0);a.load.script&&!a.load.sync&&
setTimeout(function(){E("sync")},a.load.async||0);c&&c.test("++",1,0,"update:scroll");var z=function(e){var c;switch(b.type.toLowerCase()){case "click":case "submit":c=e?h(a.scrollLeft,null,[b]):a.scrollLeft,c=0<=c?c:null,c=null===c?jQuery(q).scrollLeft():parseInt(Number(c)),e=e?h(a.scrollTop,null,[b]):a.scrollTop,e=0<=e?e:null,e=null===e?jQuery(q).scrollTop():parseInt(Number(e)),q.scrollTo(c,e)}};z(!1);c&&c.test("++",1,0,"update:rendering");setTimeout(function(){var c=jQuery(a.area).children("."+
a.nss.class4html+"-check");c.filter(function(){return this.clientWidth||jQuery(this).is(":hidden")}).length===c.length?!1!==h(a.callbacks.update.rendering.before,e,[b,a.parameter],a.callbacks.async)&&(c.remove(),a.load.script&&a.load.sync&&setTimeout(function(){E("sync")},a.load.async||0),z(!0),jQuery(window).trigger(a.gns+".load"),!1!==h(a.callbacks.update.rendering.after,e,[b,a.parameter],a.callbacks.async)&&(a.speedcheck&&a.log.speed.name.push("rendering"),a.speedcheck&&a.log.speed.time.push(a.speed.now()-
a.log.speed.fire),a.speedcheck&&console.log(a.log.speed.time),a.speedcheck&&console.log(a.log.speed.name))):c.length&&setTimeout(function(){arguments.callee()},a.interval)},0);c&&c.test("++",1,0,"update:cache");(a.cache.click||a.cache.submit||a.cache.popstate)&&("POST"!==a.ajax.type&&!1!==h(a.callbacks.update.cache.save.before,e,[b,a.parameter,d],a.callbacks.async))&&(v(a.history,r,m,C,n,l,k),h(a.callbacks.update.cache.save.after,e,[b,a.parameter,d],a.callbacks.async));c&&c.test("++",1,0,"update:verify");
if(!1!==h(a.callbacks.update.verify.before,e,[b,a.parameter],a.callbacks.async)){if(r===q.location.href)a.retry=!0;else if(a.retry)a.retry=!1,A(e,b,q.location.href,!1,a.cache[b.type.toLowerCase()]?v(a.history,q.location.href):g);else throw Error("throw: location mismatch");h(a.callbacks.update.verify.after,e,[b,a.parameter],a.callbacks.async)}if(!1===h(a.callbacks.update.success,e,[b,a.parameter,n,l,k],a.callbacks.async))break a;if(!1===h(a.callbacks.update.complete,e,[b,a.parameter,n,l,k],a.callbacks.async))break a;
if(!1===h(a.callback,e,[b,a.parameter,n,l,k],a.callbacks.async))break a;c&&c.test("++",1,0,"update: success")}catch(F){c&&c.test("++",!String(F.message).indexOf("throw:"),F,"update:catch");c&&c.test("++",!("throw: location mismatch"===F.message&&r!==q.location.href),[r,q.location.href],"!( err.message === 'throw: location mismatch' && url !== win.location.href )");d&&v(a.history,r,m,null);if(!1===h(a.callbacks.update.error,e,[b,a.parameter,n,l,k],a.callbacks.async))break a;if(!1===h(a.callbacks.update.complete,
e,[b,a.parameter,n,l,k],a.callbacks.async))break a;c&&c.test("++",1,[r,q.location.href],"update: error");if(a.fallback)return"function"===typeof a.fallback?a.fallback(b):G(b,c)}!1!==h(a.callbacks.update.after,e,[b,a.parameter,n,l,k],a.callbacks.async)&&(a.on(),a.speedcheck&&a.log.speed.name.push("ready"),a.speedcheck&&a.log.speed.time.push(a.speed.now()-a.log.speed.fire),c&&c.test("++",1,0,"update:end"),c&&c.end())}}var d=p[a.id]&&p[a.id].validate?p[a.id].validate.clone({name:"jquery.pjax.js - drive()"}):
d;d&&d.start();d&&(d.scope=function(a){return eval(a)});d&&d.test("++",1,[r,b.type],"drive()");d&&d.test("++",1,0,"drive:start");a.speedcheck&&(a.log.speed.fire=b.timeStamp);a.speedcheck&&(a.log.speed.time=[]);a.speedcheck&&(a.log.speed.name=[]);a.speedcheck&&a.log.speed.name.push("fire");a.speedcheck&&a.log.speed.time.push(a.speed.now()-a.log.speed.fire);if(!1!==h(a.callbacks.before,e,[b,a.parameter],a.callbacks.async))if(m)d&&d.test("++",1,0,"drive:update"),jQuery.when?jQuery.when(z(a.wait)).done(function(){u(m)}):
u(m),d&&d.test("++",1,0,"drive:end"),d&&d.end();else{d&&d.test("++",1,0,"drive:initialize");var n,l,k,s,t,C,H=[],x={};d&&d.test("++",1,0,"drive:popstate");"popstate"===b.type.toLowerCase()&&((H=r.match(/\?[^\s]*/))&&"?"!==H[0]&&(a.ajax.type="GET"),a.ajax.data=null);d&&d.test("++",1,0,"drive:submit");d&&d.test("*",1,jQuery(b.target).serialize(),"drive:submit");if("submit"===b.type.toLowerCase())switch(r=r.replace(/\?[^\s]*/,""),a.ajax.type=jQuery(b.target).attr("method").toUpperCase(),a.ajax.type){case "GET":d&&
d.test("++",1,jQuery(b.target).serialize(),"drive:serialize"),r+="?"+jQuery(b.target).serialize(),a.ajax.data=null;case "POST":d&&d.test("++",1,jQuery(b.target).serializeArray(),"drive:serializeArray"),a.ajax.data=jQuery(b.target).serializeArray()}d&&d.test("/",1,0,"drive:setting");jQuery.extend(!0,x,a.ajax,{xhr:a.callbacks.ajax.xhr?function(){k=h(a.callbacks.ajax.xhr,e,[b,a.parameter],a.callbacks.async);return k=k instanceof Object&&k instanceof f.XMLHttpRequest?k:k||jQuery.ajaxSettings.xhr()}:g,
beforeSend:function(d){k=d;k.setRequestHeader(a.nss.requestHeader,"true");k.setRequestHeader(a.nss.requestHeader+"-Area",a.area);k.setRequestHeader(a.nss.requestHeader+"-CSS",a.load.css);k.setRequestHeader(a.nss.requestHeader+"-Script",a.load.script);h(a.callbacks.ajax.beforeSend,e,[b,a.parameter,k],a.callbacks.async)},dataFilter:a.callbacks.ajax.dataFilter?function(d,c){n=d;l=c;return h(a.callbacks.ajax.dataFilter,e,[b,a.parameter,n,l],a.callbacks.async)||n}:g,success:function(d,c,f){n=d;l=c;k=f;
h(a.callbacks.ajax.success,e,[b,a.parameter,n,l,k],a.callbacks.async);!jQuery.when&&u()},error:function(d,c,l){k=d;s=c;t=l;var g=p[a.id]&&p[a.id].validate?p[a.id].validate.clone({name:"jquery.pjax.js - drive()"}):g;g&&g.start();g&&g.test("++",1,[r,f.location.href,k,s,t],"ajax error");h(a.callbacks.ajax.error,e,[b,a.parameter,k,s,t],a.callbacks.async);if(a.fallback)return"function"===typeof a.fallback?a.fallback(b):G(b,g);g&&g.end()},complete:a.callbacks.ajax.complete?function(d,c){k=d;s=c;h(a.callbacks.ajax.complete,
e,[b,a.parameter,k,s],a.callbacks.async)}:g});x.url=a.server.query?r.replace(/(#[^\s]*)?$/,(r.match(/\?/)?"&":"?")+encodeURIComponent(a.server.query)+"=1$1"):r;d&&d.test("++",1,0,"drive:ajax");a.speedcheck&&a.log.speed.name.push("request");a.speedcheck&&a.log.speed.time.push(a.speed.now()-a.log.speed.fire);jQuery.when?jQuery.when(jQuery.ajax(x),z(a.wait)).done(function(){u()}).fail().always():jQuery.ajax(x);!1!==h(a.callbacks.after,e,[b,a.parameter],a.callbacks.async)&&(d&&d.test("++",1,0,"drive:end"),
d&&d.end())}}function h(a,b,g,f){if("function"===typeof a)return f?setTimeout(function(){a.apply(b,g)},0):a.apply(b,g)}function z(a){var b=jQuery.Deferred();if(!a)return b.resolve();setTimeout(function(){b.resolve()},a);return b.promise()}function G(a,b){b&&b.test("++",1,0,"fallback()");b&&b.end();"click"===a.type.toLowerCase()?f.location.href=a.currentTarget.href:"submit"===a.type.toLowerCase()?context.submit():"popstate"===a.type.toLowerCase()&&f.location.reload()}function D(a,b){var g=[];a.replace(RegExp(b,
"gim"),function(a,b){g.push(b)});return g}function v(a,b,f,h,m,p,d){var n;switch(!0){case a===g||b===g:break;case f===g:a.data[b]&&(new Date).getTime()>a.data[b].timestamp+a.config.expire&&arguments.callee(a,b,null,null);n=a.data[b];break;case null===h:for(var l=0,k;k=a.order[l];l++)b===k&&(a.order.splice(l,1),a.size-=a.data[k].size,a.data[k]=null,delete a.data[k]);break;default:a.order.unshift(b);for(l=1;k=a.order[l];l++)b===k&&a.order.splice(l,1);if(a.data[b])break;h=h||1.8*m.length;a.size=a.size||
0;a.size+=h;a.data[b]={data:null,dataType:p,XMLHttpRequest:d,title:f,size:h,timestamp:(new Date).getTime()};for(l=a.order.length-1;b=a.order[l];l--)if(l>=a.config.length||a.size>a.config.size||(new Date).getTime()>a.data[b].timestamp+a.config.expire)a.order.splice(l,1),a.size=a.size||0,a.size-=a.data[b].size,a.data[b]=null,delete a.data[b]}return n}function C(a,b,f){var h;switch(!0){case b===g:h=jQuery.falsandtru[a];break;case f===g:h=a in jQuery.falsandtru?jQuery.falsandtru[a][b]:g;break;case f!==
g:jQuery.falsandtru[a]instanceof Object||(jQuery.falsandtru[a]={}),jQuery.falsandtru[a][b]instanceof Object&&f instanceof Object?jQuery.extend(!0,jQuery.falsandtru[a][b],f):jQuery.falsandtru[a][b]=f,h=jQuery.falsandtru[a][b]}return h}if("function"===typeof this)return arguments.callee.apply(jQuery(K),arguments);var m=window.validator instanceof Object?window.validator:!1;(m=m?m.clone({name:"jquery.pjax.js",base:!0,timeout:{limit:s&&s.ajax&&s.ajax.timeout?s.ajax.timeout+m.timeout.limit:m.timeout.limit}}):
m)&&m.start();m&&m.test("++",1,0,"pjax()");var a=jQuery.extend(!0,{},{id:0,gns:"pjax",ns:g,area:g,link:'a:not([target])[href^="/"]',form:g,scrollTop:0,scrollLeft:0,ajax:{},contentType:"text/html",cache:{click:!1,submit:!1,popstate:!1,length:9,size:1048576,expire:18E5},callback:function(){},callbacks:{ajax:{},update:{url:{},title:{},content:{},css:{},script:{},cache:{load:{},save:{}},rendering:{},verify:{}},async:!1},parameter:g,load:{css:!1,script:!1,execute:!0,sync:!0,async:0},interval:300,wait:0,
fallback:!0,server:{},speedcheck:!1},s),u=[a.gns];jQuery.extend(!0,a,{nss:{pjax:u.join("."),click:["click"].concat(u.join(":")).join("."),submit:["submit"].concat(u.join(":")).join("."),popstate:["popstate"].concat(u.join(":")).join("."),data:u.join(":"),class4html:u.join("-"),requestHeader:["X",u[0].replace(/^\w/,function(a){return a.toUpperCase()})].join("-"),array:u},server:{query:a.server.query===g?a.gns:a.server.query},log:{script:{},speed:{}},history:{config:a.cache,order:[],data:{}},timestamp:(new Date).getTime(),
disable:!1,on:function(){for(var a=1,b=p.length;a<b;a++)p[a].disable=!1},off:function(){for(var a=1,b=p.length;a<b;a++)p[a].disable=!0},landing:f.location.href,validate:m,retry:!0,speed:{now:function(){return(new Date).getTime()}},options:s});jQuery.falsandtru||(jQuery.fn.falsandtru=C,jQuery.falsandtru=C);jQuery.falsandtru("share","history",a.history);a.history=jQuery.falsandtru("share","history");"pushState"in f.history&&null!==f.history.pushState&&t(this,a);m&&m.end();return{on:a.on,off:a.off}}
if("undefined"!==typeof window.jQuery){jQuery=window.jQuery;var g=void 0,f=window,K=document,p=["settings"];jQuery.fn.pjax=t;jQuery.pjax=t;t=null}})();
