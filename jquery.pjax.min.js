/*
 * 
 * pjax
 * 
 * ---
 * @Copyright(c) 2012, falsandtru
 * @license MIT  http://opensource.org/licenses/mit-license.php  http://sourceforge.jp/projects/opensource/wiki/licenses%2FMIT_license
 * @version 1.17.5
 * @updated 2013/08/25
 * @author falsandtru https://github.com/falsandtru/
 * @Compressor Closure Compiler
 */
(function(c){var g=window,J=document,k=void 0,r=["settings"];c.fn.pjax=c.pjax=function(t){function K(a,b){b.id=1;r[b.id]=b;b.link&&c(a).undelegate(b.link,b.nss.click).delegate(b.link,b.nss.click,b.id,function(a){a.timeStamp=(new Date).getTime();if(1<a.which||(a.metaKey||a.ctrlKey||a.shiftKey||a.altKey)||(g.location.protocol!==this.protocol||g.location.host!==this.host)||g.location.pathname===this.pathname&&g.location.search===this.search&&g.location.hash!==this.hash)return this;var b,f,k;b=r[a.data];
f=this.href;b.area=l(b.options.area,null,[a])||b.options.area;b.landing&&(b.landing=!1);if(!b.disable&&c(b.area).length)return b.off(),b.cache[a.type.toLowerCase()]&&(k=v(b.history,f)),C(this,a,f,f!==g.location.href,k),a.preventDefault(),!1});b.form&&c(a).undelegate(b.form,b.nss.submit).delegate(b.form,b.nss.submit,b.id,function(a){a.timeStamp=(new Date).getTime();var b,f,k;b=r[a.data];f=this.action;b.area=l(b.options.area,null,[a])||b.options.area;b.landing&&(b.landing=!1);if(!b.disable&&c(b.area).length)return b.off(),
b.cache[a.type.toLowerCase()]&&(k=v(b.history,f)),C(this,a,f,!0,k),a.preventDefault(),!1});c(g).unbind(b.nss.popstate).bind(b.nss.popstate,b.id,function(a){a.timeStamp=(new Date).getTime();var b,f,k;b=r[a.data];f=g.location.href;b.area=l(b.options.area,null,[a])||b.options.area;if(b.landing){if(b.landing===g.location.href){b.landing=!1;return}b.landing=!1}if(!b.disable&&c(b.area).length)return b.off(),b.cache[a.type.toLowerCase()]&&(k=v(b.history,f)),C(this,a,f,!1,k),a.preventDefault(),!1});c("script[src]").each(function(){this.src in
b.log.script||(b.log.script[this.src]=!0)})}function C(f,b,s,L,n){function u(e){var d=r[a.id]&&r[a.id].validate?r[a.id].validate.clone({name:"jquery.pjax.js - update()"}):d;d&&d.start();d&&(d.scope=function(a){return eval(a)});d&&d.test("1",1,0,"update()");d&&d.test("++",1,0,"update:start");a:if(a.speedcheck&&a.log.speed.name.push("update"),a.speedcheck&&a.log.speed.time.push(a.speed.now()-a.log.speed.fire),!1!==l(a.callbacks.update.before,f,[b,a.parameter,p,m,h],a.callbacks.async)){var q=window,
g=document,n,t,z;try{d&&d.test("++",1,0,"update:try");d&&d.test("++",1,e?0:[a.contentType,h.getResponseHeader("Content-Type")],"update:content-type");if(!e&&!RegExp(a.contentType.replace(/\s*[,;]\s*(.|$)/g,function(a,b){return b?"|"+b:""}),"i").test(h.getResponseHeader("Content-Type")))throw Error("throw: content-type mismatch");d&&d.test("++",e?"'usable'":"'unusable'",0,"update:cache");e&&!1!==l(a.callbacks.update.cache.load.before,f,[b,a.parameter,e],a.callbacks.async)&&(h=e.XMLHttpRequest,p=h.responseText,
m=e.dataType,n=e.title,t=e.css,z=e.script,l(a.callbacks.update.cache.load.after,f,[b,a.parameter,e],a.callbacks.async));d&&d.test("++",1,0,"update:initialize");var w=c(p),A=0<w.filter("title").length,y=a.area.replace(/(\((.*?(\(.*?\).*?)?)*?\)|\S)(,|$)/g,function(a,b,f,c,d){return b+(d?"|":"")}).split(/\s*\|(?!=)\s*/);n=n?n:A?w.filter("title").text():c("<span/>").html(F(p,"<title>([^<]*)</title>").join()).text();if(!c(a.area).length||!w.find(a.area).add(w.filter(a.area)).length)throw Error("throw: area length mismatch");
d&&d.test("++",1,s,"update:url");if(!1!==l(a.callbacks.update.url.before,f,[b,a.parameter,p,m,h],a.callbacks.async)){L&&q.history.pushState(q.history.state,q.opera||-1!==q.navigator.userAgent.toLowerCase().indexOf("opera")?n:g.title,s);switch(!0){case /Mobile(\/\w+)? Safari/i.test(q.navigator.userAgent):q.history.back(),q.history.forward()}l(a.callbacks.update.url.after,f,[b,a.parameter,p,m,h],a.callbacks.async)}d&&d.test("++",1,n,"update:title");!1!==l(a.callbacks.update.title.before,f,[b,a.parameter,
p,m,h],a.callbacks.async)&&(g.title=n,l(a.callbacks.update.title.after,f,[b,a.parameter,p,m,h],a.callbacks.async));d&&d.test("++",1,y,"update:content");if(!1!==l(a.callbacks.update.content.before,f,[b,a.parameter,p,m,h],a.callbacks.async)){c(a.area).children("."+a.nss.class4html+"-check").remove();for(var g=0,D;D=y[g];g++)c(D).html(w.find(D).add(w.filter(D)).contents()).append(c("<div/>",{"class":a.nss.class4html+"-check",style:"display: block !important; visibility: hidden !important; width: auto !important; height: 0 !important; margin: 0 !important; padding: 0 !important; border: none !important; position: absolute !important; top: -9999px !important; left: -9999px !important; font-size: 12px !important; text-indent: 0 !important;"}).text("pjax"));
c(document).trigger(a.gns+".DOMContentLoaded");l(a.callbacks.update.content.after,f,[b,a.parameter,p,m,h],a.callbacks.async)}d&&d.test("++",1,0,"update:css");var M=function(){var d=r[a.id]&&r[a.id].validate?r[a.id].validate.clone({name:"jquery.pjax.js - load_css()"}):d;d&&d.start();d&&(d.scope=function(a){return eval(a)});if(!1!==l(a.callbacks.update.css.before,f,[b,a.parameter,p,m,h],a.callbacks.async)){t=t?t:A?w.find('link[rel~="stylesheet"], style').add(w.filter('link[rel~="stylesheet"], style')):
F(p,"(<link[^>]*?rel=.[^\"']*stylesheet[^>]*>|<style[^>]*>(.|[\n\r])*?</style>)");v(a.history,s)&&(v(a.history,s).css=t);c('link[rel~="stylesheet"], style').filter(function(){return c.data(this,a.nss.data,!0)});for(var e=0,k,n=c('link[rel~="stylesheet"]'),g=c("style"),q;k=t[e];e++){q=!1;k=A?k:c(k)[0];switch(k.tagName.toLowerCase()){case "link":if(n.filter(function(){if(q||this.href!==k.href)return!1;q=!0;c.removeData(this,a.nss.data);return!0}).length)continue;break;case "style":if(g.filter(function(){if(q||
!c.data(this,a.nss.data)||this.innerHTML!==k.innerHTML)return!1;q=!0;c.removeData(this,a.nss.data);return!0}).length)continue}c("head").append(k);k=null}c('link[rel~="stylesheet"], style').filter(function(){return c.data(this,a.nss.data)}).remove();c(document).trigger(a.gns+".ready");!1!==l(a.callbacks.update.css.after,f,[b,a.parameter,p,m,h],a.callbacks.async)&&(a.speedcheck&&a.log.speed.name.push("css"),a.speedcheck&&a.log.speed.time.push(a.speed.now()-a.log.speed.fire))}d&&d.end()};a.load.css&&
setTimeout(function(){M()},a.load.async||0);!a.load.css&&c(document).trigger(a.gns+".ready");d&&d.test("++",1,0,"update:script");var x=function(d){var e=r[a.id]&&r[a.id].validate?r[a.id].validate.clone({name:"jquery.pjax.js - load_script()"}):e;e&&e.start();e&&(e.scope=function(a){return eval(a)});if(!1!==l(a.callbacks.update.script.before,f,[b,a.parameter,p,m,h],a.callbacks.async)){var n=[];z=z?z:A?w.find("script").add(w.filter("script")):F(p,"(?:[^'\"]|^s*)(<script[^>]*>(.|[\n\r])*?\x3c/script>)(?:[^'\"]|s*$)");
v(a.history,s)&&(v(a.history,s).script=z);for(var q=0,g;g=z[q];q++)if(g=A?g:c(g)[0],"sync"!==d||g.defer)"async"===d&&g.defer||!g.childNodes.length&&g.src in a.log.script||(g.src&&(a.log.script[g.src]=!0),c.when?(g=g.src?c.ajax(c.extend(!0,{},a.ajax,{url:g.src,dataType:"script",async:!1,global:!1})):c.Deferred().resolve(a.load.execute?g:k),n.push(g)):c("head").append(g),g=null);c.when&&n.length&&c.when.apply(null,n).done(function(){for(var a=0,b;b=arguments[a];a++)0<Number(b.nodeType)&&(!b.type||-1<
b.type.toLowerCase().indexOf("text/javascript"))&&eval((b.text||b.textContent||b.innerHTML||"").replace(/^\s*<!(?:\[CDATA\[|\-\-)/,"/*$0*/"))});!1!==l(a.callbacks.update.script.after,f,[b,a.parameter,p,m,h],a.callbacks.async)&&(a.speedcheck&&"async"===d&&a.log.speed.name.push("script"),a.speedcheck&&"async"===d&&a.log.speed.time.push(a.speed.now()-a.log.speed.fire))}e&&e.end()};a.load.script&&setTimeout(function(){x("async")},a.load.async||0);a.load.script&&!a.load.sync&&setTimeout(function(){x("sync")},
a.load.async||0);d&&d.test("++",1,0,"update:scroll");var B=function(f){var d;switch(b.type.toLowerCase()){case "click":case "submit":d=f?l(a.scrollLeft,null,[b]):a.scrollLeft,d=0<=d?d:null,d=null===d?c(q).scrollLeft():parseInt(Number(d)),f=f?l(a.scrollTop,null,[b]):a.scrollTop,f=0<=f?f:null,f=null===f?c(q).scrollTop():parseInt(Number(f)),q.scrollTo(d,f)}};B(!1);d&&d.test("++",1,0,"update:rendering");setTimeout(function(){var d=c(a.area).children("."+a.nss.class4html+"-check");d.filter(function(){return this.clientWidth||
c(this).is(":hidden")}).length===d.length?!1!==l(a.callbacks.update.rendering.before,f,[b,a.parameter],a.callbacks.async)&&(d.remove(),a.load.script&&a.load.sync&&setTimeout(function(){x("sync")},a.load.async||0),B(!0),c(window).trigger(a.gns+".load"),!1!==l(a.callbacks.update.rendering.after,f,[b,a.parameter],a.callbacks.async)&&(a.speedcheck&&a.log.speed.name.push("rendering"),a.speedcheck&&a.log.speed.time.push(a.speed.now()-a.log.speed.fire),a.speedcheck&&console.log(a.log.speed.time),a.speedcheck&&
console.log(a.log.speed.name))):d.length&&setTimeout(function(){arguments.callee()},a.interval)},0);d&&d.test("++",1,0,"update:cache");(a.cache.click||a.cache.submit||a.cache.popstate)&&("POST"!==a.ajax.type&&!1!==l(a.callbacks.update.cache.save.before,f,[b,a.parameter,e],a.callbacks.async))&&(v(a.history,s,n,E,p,m,h),l(a.callbacks.update.cache.save.after,f,[b,a.parameter,e],a.callbacks.async));d&&d.test("++",1,0,"update:verify");if(!1!==l(a.callbacks.update.verify.before,f,[b,a.parameter],a.callbacks.async)){if(s===
q.location.href)a.retry=!0;else if(a.retry)a.retry=!1,C(f,b,q.location.href,!1,a.cache[b.type.toLowerCase()]?v(a.history,q.location.href):k);else throw Error("throw: location mismatch");l(a.callbacks.update.verify.after,f,[b,a.parameter],a.callbacks.async)}if(!1===l(a.callbacks.update.success,f,[b,a.parameter,p,m,h],a.callbacks.async))break a;if(!1===l(a.callbacks.update.complete,f,[b,a.parameter,p,m,h],a.callbacks.async))break a;if(!1===l(a.callback,f,[b,a.parameter,p,m,h],a.callbacks.async))break a;
d&&d.test("++",1,0,"update: success")}catch(G){d&&d.test("++",!String(G.message).indexOf("throw:"),G,"update:catch");d&&d.test("++",!("throw: location mismatch"===G.message&&s!==q.location.href),[s,q.location.href],"!( err.message === 'throw: location mismatch' && url !== win.location.href )");e&&v(a.history,s,n,null);if(!1===l(a.callbacks.update.error,f,[b,a.parameter,p,m,h],a.callbacks.async))break a;if(!1===l(a.callbacks.update.complete,f,[b,a.parameter,p,m,h],a.callbacks.async))break a;d&&d.test("++",
1,[s,q.location.href],"update: error");if(a.fallback)return"function"===typeof a.fallback?a.fallback(b):H(b,d)}!1!==l(a.callbacks.update.after,f,[b,a.parameter,p,m,h],a.callbacks.async)&&(a.on(),a.speedcheck&&a.log.speed.name.push("ready"),a.speedcheck&&a.log.speed.time.push(a.speed.now()-a.log.speed.fire),d&&d.test("++",1,0,"update:end"),d&&d.end())}}var e=r[a.id]&&r[a.id].validate?r[a.id].validate.clone({name:"jquery.pjax.js - drive()"}):e;e&&e.start();e&&(e.scope=function(a){return eval(a)});e&&
e.test("++",1,[s,b.type],"drive()");e&&e.test("++",1,0,"drive:start");a.speedcheck&&(a.log.speed.fire=b.timeStamp);a.speedcheck&&(a.log.speed.time=[]);a.speedcheck&&(a.log.speed.name=[]);a.speedcheck&&a.log.speed.name.push("fire");a.speedcheck&&a.log.speed.time.push(a.speed.now()-a.log.speed.fire);if(!1!==l(a.callbacks.before,f,[b,a.parameter],a.callbacks.async))if(n)e&&e.test("++",1,0,"drive:update"),c.when?c.when(B(a.wait)).done(function(){u(n)}):u(n),e&&e.test("++",1,0,"drive:end"),e&&e.end();
else{e&&e.test("++",1,0,"drive:initialize");var p,m,h,t,x,E,I=[],y={};e&&e.test("++",1,0,"drive:popstate");"popstate"===b.type.toLowerCase()&&((I=s.match(/\?[^\s]*/))&&"?"!==I[0]&&(a.ajax.type="GET"),a.ajax.data=null);e&&e.test("++",1,0,"drive:submit");e&&e.test("*",1,c(b.target).serialize(),"drive:submit");if("submit"===b.type.toLowerCase())switch(s=s.replace(/\?[^\s]*/,""),a.ajax.type=c(b.target).attr("method").toUpperCase(),a.ajax.type){case "GET":e&&e.test("++",1,c(b.target).serialize(),"drive:serialize"),
s+="?"+c(b.target).serialize(),a.ajax.data=null;case "POST":e&&e.test("++",1,c(b.target).serializeArray(),"drive:serializeArray"),a.ajax.data=c(b.target).serializeArray()}e&&e.test("/",1,0,"drive:setting");c.extend(!0,y,a.ajax,{xhr:a.callbacks.ajax.xhr?function(){h=l(a.callbacks.ajax.xhr,f,[b,a.parameter],a.callbacks.async);return h=h instanceof Object&&h instanceof g.XMLHttpRequest?h:h||c.ajaxSettings.xhr()}:k,beforeSend:function(c){h=c;h.setRequestHeader(a.nss.requestHeader,"true");h.setRequestHeader(a.nss.requestHeader+
"-Area",a.area);h.setRequestHeader(a.nss.requestHeader+"-CSS",a.load.css);h.setRequestHeader(a.nss.requestHeader+"-Script",a.load.script);l(a.callbacks.ajax.beforeSend,f,[b,a.parameter,h],a.callbacks.async)},dataFilter:a.callbacks.ajax.dataFilter?function(c,d){p=c;m=d;return l(a.callbacks.ajax.dataFilter,f,[b,a.parameter,p,m],a.callbacks.async)||p}:k,success:function(e,d,g){p=e;m=d;h=g;l(a.callbacks.ajax.success,f,[b,a.parameter,p,m,h],a.callbacks.async);!c.when&&u()},error:function(c,d,e){h=c;t=
d;x=e;var k=r[a.id]&&r[a.id].validate?r[a.id].validate.clone({name:"jquery.pjax.js - drive()"}):k;k&&k.start();k&&k.test("++",1,[s,g.location.href,h,t,x],"ajax error");l(a.callbacks.ajax.error,f,[b,a.parameter,h,t,x],a.callbacks.async);if(a.fallback)return"function"===typeof a.fallback?a.fallback(b):H(b,k);k&&k.end()},complete:a.callbacks.ajax.complete?function(c,d){h=c;t=d;l(a.callbacks.ajax.complete,f,[b,a.parameter,h,t],a.callbacks.async)}:k});y.url=a.server.query?s.replace(/(#[^\s]*)?$/,(s.match(/\?/)?
"&":"?")+encodeURIComponent(a.server.query)+"=1$1"):s;e&&e.test("++",1,0,"drive:ajax");a.speedcheck&&a.log.speed.name.push("request");a.speedcheck&&a.log.speed.time.push(a.speed.now()-a.log.speed.fire);c.when?c.when(c.ajax(y),B(a.wait)).done(function(){u()}).fail().always():c.ajax(y);!1!==l(a.callbacks.after,f,[b,a.parameter],a.callbacks.async)&&(e&&e.test("++",1,0,"drive:end"),e&&e.end())}}function l(a,b,c,k){if("function"===typeof a)return k?setTimeout(function(){a.apply(b,c)},0):a.apply(b,c)}function B(a){var b=
c.Deferred();if(!a)return b.resolve();setTimeout(function(){b.resolve()},a);return b.promise()}function H(a,b){b&&b.test("++",1,0,"fallback()");b&&b.end();"click"===a.type.toLowerCase()?g.location.href=a.currentTarget.href:"submit"===a.type.toLowerCase()?context.submit():"popstate"===a.type.toLowerCase()&&g.location.reload()}function F(a,b){var c=[];a.replace(RegExp(b,"gim"),function(a,b){c.push(b)});return c}function v(a,b,c,g,l,n,e){var p;switch(!0){case a===k||b===k:break;case c===k:a.data[b]&&
(new Date).getTime()>a.data[b].timestamp+a.config.expire&&arguments.callee(a,b,null,null);p=a.data[b];break;case null===g:for(var m=0,h;h=a.order[m];m++)b===h&&(a.order.splice(m,1),a.size-=a.data[h].size,a.data[h]=null,delete a.data[h]);break;default:a.order.unshift(b);for(m=1;h=a.order[m];m++)b===h&&a.order.splice(m,1);if(a.data[b])break;g=g||1.8*l.length;a.size=a.size||0;a.size+=g;a.data[b]={data:null,dataType:n,XMLHttpRequest:e,title:c,size:g,timestamp:(new Date).getTime()};for(m=a.order.length-
1;b=a.order[m];m--)if(m>=a.config.length||a.size>a.config.size||(new Date).getTime()>a.data[b].timestamp+a.config.expire)a.order.splice(m,1),a.size=a.size||0,a.size-=a.data[b].size,a.data[b]=null,delete a.data[b]}return p}function E(a,b,g){var l;switch(!0){case b===k:l=c.falsandtru[a];break;case g===k:l=a in c.falsandtru?c.falsandtru[a][b]:k;break;case g!==k:c.falsandtru[a]instanceof Object||(c.falsandtru[a]={}),c.falsandtru[a][b]instanceof Object&&g instanceof Object?c.extend(!0,c.falsandtru[a][b],
g):c.falsandtru[a][b]=g,l=c.falsandtru[a][b]}return l}if("function"===typeof this)return arguments.callee.apply(c(J),arguments);var n=window.validator instanceof Object?window.validator:!1;(n=n?n.clone({name:"jquery.pjax.js",base:!0,timeout:{limit:t&&t.ajax&&t.ajax.timeout?t.ajax.timeout+n.timeout.limit:n.timeout.limit}}):n)&&n.start();n&&n.test("++",1,0,"pjax()");var a=c.extend(!0,{},{id:0,gns:"pjax",ns:k,area:k,link:'a:not([target])[href^="/"]',form:k,scrollTop:0,scrollLeft:0,ajax:{},contentType:"text/html",
cache:{click:!1,submit:!1,popstate:!1,length:9,size:1048576,expire:18E5},callback:function(){},callbacks:{ajax:{},update:{url:{},title:{},content:{},css:{},script:{},cache:{load:{},save:{}},rendering:{},verify:{}},async:!1},parameter:k,load:{css:!1,script:!1,execute:!0,sync:!0,async:0},interval:300,wait:0,fallback:!0,server:{},speedcheck:!1},t),u=[a.gns];c.extend(!0,a,{nss:{pjax:u.join("."),click:["click"].concat(u.join(":")).join("."),submit:["submit"].concat(u.join(":")).join("."),popstate:["popstate"].concat(u.join(":")).join("."),
data:u.join(":"),class4html:u.join("-"),requestHeader:["X",u[0].replace(/^\w/,function(a){return a.toUpperCase()})].join("-"),array:u},server:{query:a.server.query===k?a.gns:a.server.query},log:{script:{},speed:{}},history:{config:a.cache,order:[],data:{}},timestamp:(new Date).getTime(),disable:!1,on:function(){for(var a=1,b=r.length;a<b;a++)r[a].disable=!1},off:function(){for(var a=1,b=r.length;a<b;a++)r[a].disable=!0},landing:g.location.href,validate:n,retry:!0,speed:{now:function(){return(new Date).getTime()}},
options:t});c.falsandtru||(c.fn.falsandtru=E,c.falsandtru=E);c.falsandtru("share","history",a.history);a.history=c.falsandtru("share","history");"pushState"in g.history&&null!==g.history.pushState&&K(this,a);n&&n.end();return{on:a.on,off:a.off}}})(jQuery);
